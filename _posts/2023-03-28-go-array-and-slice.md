---
title: Golang 数组和切片
date: 2023/3/28 12:10:25
tags: 
    - ["技术", "Go"]
categories:
    - 技术
---

## 概述

在实际编程中，数组和切片都是非常常用的数据类型。虽然它们在某些方面相似，但是也有很多不同的地方。本文将会详细讨论数组和切片的不同之处，同时也会介绍它们各自的用途、使用方法以及内部底层实现。


## 数组

数组是一种有固定大小的数据结构，它包含了同种类型的数据元素。在Go语言中，数组的大小是在定义时确定的，无法修改。数组在内存中是连续存储的，因此访问数组元素时的时间复杂度是O(1)，这使得数组在一些需要高效随机访问元素的场景中十分有用。下面是一个简单的示例程序：

```go
package main

import "fmt"

func main() {
    var arr [5]int
    for i := 0; i < len(arr); i++ {
        arr[i] = i * i
    }
    fmt.Println(arr)
}
```

该程序创建了一个长度为5的整型数组，并将其元素设置为它们的平方。使用fmt.Println()函数打印数组的值，输出为`[0 1 4 9 16]`。

## 切片

但与此同时，由于数组的长度是固定的，一旦申请数组空间后，其长度就无法更改，即使某些数据未被使用，也必须占用一定的内存空间，这样会导致内存的浪费。

切片是一种基于数组的动态数据结构，它可以自由扩展和收缩。切片的实现使用了底层数组的指针，并且切片自身包含了长度、容量两个属性。下面是一个简单的示例程序：

```go
package main

import "fmt"

func main() {
    s1 := []int{1, 2, 3, 4, 5}
    s2 := s1[1:3]
    fmt.Println(s2, len(s2), cap(s2))
}
```

该程序创建了一个包含5个整型元素的切片s1，并使用s1[1:3]语法创建了一个新的切片s2。使用len()函数和cap()函数分别打印了s2的长度和容量，输出为[2 3] 2 4。这里需要注意的是，切片的容量是指从切片开始位置到底层数据结构的结尾位置间的元素个数。

## 切片的扩容

在切片扩容时，Go语言会先创建一个新的更大的数组，然后将原数组中的元素复制到这个新的数组中。如此一来，新的切片就可以使用更多可用内存，而原有的数据也不会被错误地覆盖掉。需要注意的是，切片扩容操作会消耗较多的内存，且在扩容前必须拷贝整个数组的内容，因此扩容操作也是比较耗时的。与数组相比，切片更加灵活方便，并且可以满足对数据大小和性能的不同要求。但这种灵活性和可扩展性也导致切片的性能较差，消耗更多的内存，并且在切片频繁扩容时会有一定的开销。

下面是一个使用append()函数向切片动态添加元素的示例程序：

```go
package main

import "fmt"

func main() {
    s := []int{1, 2, 3}
    fmt.Println(s, len(s), cap(s)) // [1 2 3] 3 3
    s = append(s, 4)
    fmt.Println(s, len(s), cap(s)) // [1 2 3 4] 4 6
    s = append(s, 5, 6, 7)
    fmt.Println(s, len(s), cap(s)) // [1 2 3 4 5 6 7] 7 12
}
```

该程序创建了一个包含3个整型元素的切片s，使用append()函数向s中添加了多个元素。使用len()函数和cap()函数分别打印了s的长度和容量，可以看到，随着元素的添加，切片的长度和容量都发生了改变。

## 实现

从底层实现来看，数组和切片的不同之处在于数组通过连续的内存空间来存储结构化数据，而切片则使用了动态的内存管理机制。正是由于切片使用了动态的内存管理机制，它才更加方便和灵活，可以满足对数据大小和性能的不同要求。但这种灵活性和可扩展性也导致切片的性能较差，消耗更多的内存，并且在切片频繁扩容时会有一定的开销。

综上所述，在选择数据类型时，我们需要根据实际需求来选择合适的数据结构。如果我们需要处理的数据量较小，而且长度是固定的，那么数组就是一个好的选择；如果我们需要经常进行数据的添加和删除操作，那么切片就是更好的选择。同时，我们在使用切片时需要注意切片底层数组的长度和容量，避免因为未合理地使用切片而导致内存浪费或性能下降的问题。

## 总结

总结来说，数组和切片都是Go语言中的常用数据类型，它们各有优缺点。无论你是选择数组还是切片，都需要根据实际情况进行取舍，以便更好地满足自己的需求。
